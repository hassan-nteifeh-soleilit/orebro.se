#set ($propertyUtil = $sitevisionUtils.propertyUtil)#set ($linkRenderer = $sitevisionUtils.linkRenderer)#set ($portletContextUtil = $sitevisionUtils.portletContextUtil)#set ($years = $propertyUtil.getNode($portlet, "years"))#set ($dateUtil = $sitevisionUtils.dateUtil)$linkRenderer.setFontClass('selectorText')#set ($years = $propertyUtil.getNode($portlet, "years"))#set ($DAY_OF_MONTH = 5) ## Java Calender.DAY_OF_MONTH constant<h2 class="or-news-filter-header">Filtrera på:</h2><div class="or-news-filter">	<div class="or-category-filter">		<!-- Huvudrad -->		<div class="or-colorborder or-wrapper-click or-plus-box-header or-plus-box-diskret-header or-plus-box-active">			<!-- Plus -->			<div class="or-collapse-button or-colorbg">				<div class="or-icon-area"><span class="or-icon-plus"></span></div>   			</div>					<!-- Rubrik -->			<div class="or-collapsible-header or-js-collapsible-header">				<div class="plusboxxrubrik">Kategori</div>			</div>				</div>		<div class="or-plus-box-diskret-content">        <ul class="or-category" data-selected="">      					<li class="or-category-item" data-value="kultur">Kultur & fritid</li>					<li class="or-category-item" data-value="barn">Barn & utbildning</li>					<li class="or-category-item" data-value="omsorg">Omsorg & stöd</li>					<li class="or-category-item" data-value="bygga">Bygga, bo & trafik</li>					<li class="or-category-item" data-value="foretag">Företag & näringsliv</li>					<li class="or-category-item" data-value="kommun">Kommun & politik</li>        </ul>		</div>	</div>   #### Iterate over every year#foreach ($year in $years.getNodes())     #if($velocityCount == 1)			<div class="or-daterange-filter">		<!-- Huvudrad -->    <div class="or-colorborder or-wrapper-click or-plus-box-header or-plus-box-diskret-header or-plus-box-active">			<!-- Plusruta -->			<div class="or-collapse-button or-colorbg">				<div class="or-icon-area"><span class="or-icon-plus"></span></div>         </div>		      <!-- Rubrik -->      <div class="or-collapsible-header or-js-collapsible-header">				<div class="plusboxxrubrik">År månad</div>      </div>		    </div>    <div class="or-plus-box-diskret-content">			<ul class="or-daterange" data-selected="">           		#set($render = true)     #end  #set ($renderedMonths = false)  ## Render year name  #set ($yearName = $propertyUtil.getString($year, "name"))				<li class="or-year or-parent">									<span class="or-toggle-icon"></span>   	          <span class="or-item-text">$yearName</span>					     ## Iterate over every month in the year  #foreach ($month in $year.getNodes())            		## Render month name and URL				#set ($name = $propertyUtil.getString($month, "name"))		#set ($title = $propertyUtil.getString($month, "title"))		#set ($url = $propertyUtil.getString($month, "URL"))		#set ($startDate = $propertyUtil.getCalendar($month, "startDate"))    		#set ($startDay = $dateUtil.getCalendarAsString( "yyyy-MM-dd",$startDate))          		## Last date in month		#set ($monthMax = $startDate.getActualMaximum($DAY_OF_MONTH))      		$startDate.set($DAY_OF_MONTH,$monthMax)      		#set ($endDay = $dateUtil.getCalendarAsString( "yyyy-MM-dd",$startDate))		#set ($hitsInMonth = $propertyUtil.getInt($month, "count"))                        		#if ($hitsInMonth > 0)			#if (!$renderedMonths)  					#set ($renderedMonths = true)					<ul>			#end						## Datumintervall som används för filtrering i den dynamiska sökfrågan i nyhetslistningen						<li data-value="[${startDay}T00:00:00.000Z TO ${endDay}T23:59:59.999Z]" class="or-month">$name</li>			##set($monthCount = $monthCount + 1)		#end      	#end	#if ($renderedMonths)					</ul>	#end				</li> ## <-- or-year or-parent#end#if ($render)			</ul>  ## <-- or-daterange          		</div>  ## <-- or-plus-box-diskret-content	</div> ## <--or-daterange-filter#end     </div> ##<-- or-news-filter#set ($dollar = '$')<script>(function(${dollar}) {				window.loadList = function loadList(page)  {		var reqdata ={ajaxcall:true};									var category = $('ul.or-category li.or-category-item.selected').data('value');		var daterange = $('ul.or-daterange li.or-month.selected').data('value');                		if (typeof(category) != undefined && category != "") {			 reqdata.cat = category;       		}		if (typeof(daterange) != undefined && daterange != "") {			 reqdata.daterange = daterange;       		}					if(page) {			 reqdata.page = page;    			 $dollar('button.or-load-more i.fa-refresh').addClass('fa-spin');        		}		var url = "$portletContextUtil.getCurrentPage().getIdentifier()/Nyhetssok.portlet";						${dollar}.get(url, reqdata, function(data) {       			 $('button.or-load-more').hide('slow').remove();			 if(reqdata.page) {				$('.or-news-list').append(data); 			 } else {				$('.or-news-list').html(data);  			 }		});	}			/* document ready */            	$(document).ready(function() {				/* Filter click handling*/		//alert("Inside ready ") ; 		$('.or-news-filter li.or-month, .or-news-filter li.or-category-item').click(function(){									$(this).toggleClass('selected');			$(this).siblings().removeClass('selected'); 							loadList();					}); 					$('.or-plus-box-header').click( function () {							$(this).next('.or-plus-box-diskret-content').slideToggle(200);			$(this).toggleClass("or-plus-box-active");		});	 		$(".or-news-filter .or-toggle-icon").click(function() {   						$(this).parent().toggleClass("or-expanded");		});	 		/* Closed filters in mobile */		if ($('.or-mobile-menu-bar').css('display') === 'block') {							$('.or-plus-box-header').click();						}       	}); // document ready	}(jQuery)); </script>